
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Nullam urna elit, malesuada eget finibus ut, ac tortor.">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.4">
    
    
      
        <title>Lorem ipsum dolor sit amet - Gems</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bde7dde4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ef6f36e2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-to-migrate-git-repository" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Gems" class="md-header__button md-logo" aria-label="Gems" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Gems
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lorem ipsum dolor sit amet
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Gems" class="md-nav__button md-logo" aria-label="Gems" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Gems
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Python
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Python" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../python/design-patterns/" class="md-nav__link">
        Design Patterns
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../python/tdd/" class="md-nav__link">
        Test Driven Development (TDD)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../python/kata/" class="md-nav__link">
        Kata
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../python/tricks/" class="md-nav__link">
        Tricks
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../python/misc/" class="md-nav__link">
        Misc Python Topics
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Other
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Other" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Other
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../sqlserver/" class="md-nav__link">
        SQL Server
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../blog/" class="md-nav__link">
        Blog
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-to-migrate-git-repository" class="md-nav__link">
    How to migrate git repository
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pre-requisites" class="md-nav__link">
    Pre-requisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-do-it" class="md-nav__link">
    How to do it?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-works" class="md-nav__link">
    How it works?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#theres-more" class="md-nav__link">
    There's more...
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Lorem ipsum dolor sit amet</h1>
                
                <h2 id="how-to-migrate-git-repository">How to migrate git repository</h2>
<div class="mermaid">sequenceDiagram
    Source Repo-&gt;&gt;Local Mirror: clone --mirror &lt;soource&gt;
    Local Mirror-&gt;&gt;Target Repo: push --mirror &lt;target&gt;</div>

<p>Sometimes you need to migrate an existing Git repository into a new repository. The migration needs to guarantee that the full commit history, branches, etc. is preserved.</p>
<p>In my case I am going to migrate a Git repository from one Azure DevOps organization into a new repository from another Azure DevOps organization. The solution applies not only to Azure DevOps git, but to any git repository and can be used to migrate even between different platforms - GitHub, GitLab, Bitbucket, etc.</p>
<h2 id="pre-requisites">Pre-requisites</h2>
<ul>
<li>You have an existing repository <code>myapp</code> with URL https://dev.azure.com/hemus/svetlina/_git/myapp</li>
<li>You have an empty target repository <code>newapp</code> with URL https://dev.azure.com/asizen/svetlina/_git/newapp</li>
</ul>
<p><strong>WARNING:</strong> If the target repository is not empty, it will be completely overwritten!</p>
<h2 id="how-to-do-it">How to do it?</h2>
<p>I am defining two environment variables to make the following steps more clear:</p>
<div class="highlight"><pre><span></span><code>$ <span class="nv">SOURCE_REPO</span><span class="o">=</span>https://dev.azure.com/hemus/svetlina/_git/myapp

$ <span class="nv">TARGET_REPO</span><span class="o">=</span>https://dev.azure.com/asizen/svetlina/_git/newapp
</code></pre></div>

<p><strong>Step 1:</strong> Mirror clone</p>
<div class="highlight"><pre><span></span><code>$ git clone --mirror <span class="nv">$SOURCE_REPO</span>
Cloning into bare repository <span class="s1">&#39;myapp.git&#39;</span>...
remote: Azure Repos
remote: Found <span class="m">79</span> objects to send. <span class="o">(</span><span class="m">1</span> ms<span class="o">)</span>
Unpacking objects: <span class="m">100</span>% <span class="o">(</span><span class="m">79</span>/79<span class="o">)</span>, <span class="k">done</span>.
</code></pre></div>

<p><strong>Step 2:</strong> Push to the new repo</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">cd</span> myapp.git
$ git push --mirror <span class="nv">$TARGET_REPO</span>
Enumerating objects: <span class="m">79</span>, <span class="k">done</span>.
Counting objects: <span class="m">100</span>% <span class="o">(</span><span class="m">79</span>/79<span class="o">)</span>, <span class="k">done</span>.
Delta compression using up to <span class="m">8</span> threads
Compressing objects: <span class="m">100</span>% <span class="o">(</span><span class="m">61</span>/61<span class="o">)</span>, <span class="k">done</span>.
Writing objects: <span class="m">100</span>% <span class="o">(</span><span class="m">79</span>/79<span class="o">)</span>, <span class="m">7</span>.77 KiB <span class="p">|</span> <span class="m">795</span>.00 KiB/s, <span class="k">done</span>.
Total <span class="m">79</span> <span class="o">(</span>delta <span class="m">24</span><span class="o">)</span>, reused <span class="m">0</span> <span class="o">(</span>delta <span class="m">0</span><span class="o">)</span>
remote: Analyzing objects... <span class="o">(</span><span class="m">79</span>/79<span class="o">)</span> <span class="o">(</span><span class="m">7</span> ms<span class="o">)</span>
remote: Storing packfile... <span class="k">done</span> <span class="o">(</span><span class="m">325</span> ms<span class="o">)</span>
remote: Storing index... <span class="k">done</span> <span class="o">(</span><span class="m">86</span> ms<span class="o">)</span>
To https://dev.azure.com/asizen/svetlina/_git/newapp
 * <span class="o">[</span>new branch<span class="o">]</span>      main -&gt; main
</code></pre></div>

<p><strong>Step 3:</strong> Validate the migration</p>
<p>First clone the new repository.</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">cd</span> ..
$ git clone <span class="nv">$TARGET_REPO</span>
Cloning into <span class="s1">&#39;newapp&#39;</span>...
<span class="nb">cd</span> newapp
remote: Azure Repos
remote: Found <span class="m">79</span> objects to send. <span class="o">(</span><span class="m">29</span> ms<span class="o">)</span>
Unpacking objects: <span class="m">100</span>% <span class="o">(</span><span class="m">79</span>/79<span class="o">)</span>, <span class="k">done</span>.
$ <span class="nb">cd</span> newapp
</code></pre></div>

<p>You can browse the content of the repository:</p>
<div class="highlight"><pre><span></span><code>$ ls -lR
.:
total <span class="m">4</span>
drwxr-xr-x <span class="m">1</span> ivang <span class="m">197609</span>   <span class="m">0</span> May <span class="m">15</span> <span class="m">08</span>:45 azure-pipelines/
-rw-r--r-- <span class="m">1</span> ivang <span class="m">197609</span> <span class="m">985</span> May <span class="m">15</span> <span class="m">08</span>:45 README.md

./azure-pipelines:
total <span class="m">0</span>
drwxr-xr-x <span class="m">1</span> ivang <span class="m">197609</span> <span class="m">0</span> May <span class="m">15</span> <span class="m">08</span>:45 pipelines/
drwxr-xr-x <span class="m">1</span> ivang <span class="m">197609</span> <span class="m">0</span> May <span class="m">15</span> <span class="m">08</span>:45 vars/
...
</code></pre></div>

<p>You should see the same content as in the source repository.</p>
<p>Check the branches.</p>
<div class="highlight"><pre><span></span><code>$ git branch -r
$ git branch -r
  origin/HEAD -&gt; origin/dev
  origin/dev
  origin/main
</code></pre></div>

<h2 id="how-it-works">How it works?</h2>
<p>Using the <code>--mirror</code> option in when cloning the repository causes git to mirror the full content, create a <em>mirror</em> clone, of the repository into the local filesystem. The <em>mirror</em> maps local branches of the source to local branches of the target, it also maps all refs (including remote-tracking branches, notes etc.) and sets up a refspec configuration such that all these refs are overwritten by a <code>git remote update</code> in the target repository. The <em>mirror</em> clone does not generate a working copy. Let's see this in practice.</p>
<p>Regular clone creates a working copy of the repository:</p>
<div class="highlight"><pre><span></span><code>$ git clone <span class="nv">$SOURCE_REPO</span>
Cloning into <span class="s1">&#39;myapp&#39;</span>...
ls myappremote: Azure Repos
remote: Found <span class="m">79</span> objects to send. <span class="o">(</span><span class="m">1</span> ms<span class="o">)</span>
Unpacking objects: <span class="m">100</span>% <span class="o">(</span><span class="m">79</span>/79<span class="o">)</span>, <span class="k">done</span>.
$ ls myapp
azure-pipelines/  README.md
</code></pre></div>

<p>The mirror clone contains complete git repository snapshot:</p>
<div class="highlight"><pre><span></span><code>$ git clone --mirror <span class="nv">$SOURCE_REPO</span>
$ ls myapp.git
config  description  HEAD  hooks/  info/  objects/  packed-refs  refs/
</code></pre></div>

<p>As you can see from the above listings, the mirror clone doesn't contain a working copy, but a snapshot of the entire git repository.</p>
<p>The <code>--mirror</code> option when pushing the repository instructs git that we want to replace the target git repository completely with the local snapshot.</p>
<h2 id="theres-more">There's more...</h2>
<ul>
<li>
<p>In this solution we use <em>mirror</em> clone of the repository. There is also a <em>bare</em> clone of the repository. <em>Mirror</em> clone is a kind of a <em>bare</em> clone. Check the <code>git clone</code> <a href="https://git-scm.com/docs/git-clone">documentation</a> to learn about <em>bare</em> and <em>mirror</em> clones.</p>
</li>
<li>
<p>In case you want to push only a single branch into another repository, check <a href="https://www.atlassian.com/git/tutorials/git-move-repository">How to move a full Git repository</a> at Atlassian</p>
</li>
<li>
<p>On migrating git repository at other sources:</p>
</li>
<li>
<p><a href="https://gitenterprise.me/2016/03/30/how-to-migrate-a-git-repository/">How to Migrate a Git Repository</a> at GitEnterprise</p>
</li>
<li><a href="https://docs.microsoft.com/en-us/azure/devops/repos/git/move-git-repos-between-team-projects">Move Git repositories to another project with full-fidelity history</a> at Microsoft</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.4fa0e4ee.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.1d3bfcf1.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script>
      
    
  </body>
</html>