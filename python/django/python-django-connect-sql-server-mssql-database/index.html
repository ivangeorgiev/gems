
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.9">
    
    
      
        <title>Connect Django to Microsoft SQL Server (MSSQL) Database - Gems</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.08040f6c.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#connect-django-to-microsoft-sql-server-mssql-database" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Gems" class="md-header__button md-logo" aria-label="Gems" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Gems
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Connect Django to Microsoft SQL Server (MSSQL) Database
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Gems" class="md-nav__button md-logo" aria-label="Gems" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Gems
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../design-patterns/" class="md-nav__link">
        Design Patterns
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tdd/" class="md-nav__link">
        Test Driven Development (TDD)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../kata/" class="md-nav__link">
        Kata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tricks/" class="md-nav__link">
        Tricks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/" class="md-nav__link">
        Misc Python Topics
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Other
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Other" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Other
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../sqlserver/" class="md-nav__link">
        SQL Server
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/" class="md-nav__link">
        Blog
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup-database-connectivity" class="md-nav__link">
    Setup Database Connectivity
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-the-database-schema-for-django-application" class="md-nav__link">
    Setup the Database Schema for Django Application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-the-database-using-environment-variables" class="md-nav__link">
    Configure the Database using Environment Variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="connect-django-to-microsoft-sql-server-mssql-database">Connect Django to Microsoft SQL Server (MSSQL) Database</h1>
<p>We need to connect Django to a Microsoft SQL Server. In addition, we have some more requirements to the way we implement the connectivity:</p>
<ul>
<li>Connect Django to Microsoft SQL Server and Azure SQL Database</li>
<li>Keep database tables organized into a single database schema</li>
<li>Be able to easily configure the database settings</li>
<li>Be able to change the database engine (e.g. locally work with SQLite, on production work with Azure SQL Database)</li>
</ul>
<p>We are going to use <code>mssql-django</code> package which is a fork of <code>django-mssql-backend</code>. It uses internally the <code>pyodbc</code> package.</p>
<h2 id="setup-database-connectivity">Setup Database Connectivity</h2>
<p>Install the <code>mssql-django</code> package:</p>
<div class="highlight"><pre><span></span><code>$ pip install mssql-django
...
</code></pre></div>
<p>Update your <code>settings.py</code> for your Django project. Here is an example. For further details, refer to the <code>mssql-django</code> package <a href="https://github.com/microsoft/mssql-django">documentation</a>:</p>
<div class="highlight"><pre><span></span><code><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1"># String. It must be &quot;mssql&quot;.</span>
        <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;mssql&#39;</span><span class="p">,</span>

        <span class="c1"># String. Database name. Required.</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;mydb&#39;</span><span class="p">,</span>

        <span class="c1"># String. Database user name in &quot;user&quot; format. If not given then MS Integrated Security will be used.</span>
        <span class="s1">&#39;USER&#39;</span><span class="p">:</span> <span class="s1">&#39;user@myserver&#39;</span><span class="p">,</span>

        <span class="c1"># String. Database user password.</span>
        <span class="s1">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>

         <span class="c1"># String. SQL Server instance in &quot;server\instance&quot; format.</span>
        <span class="s1">&#39;HOST&#39;</span><span class="p">:</span> <span class="s1">&#39;myserver.database.windows.net&#39;</span><span class="p">,</span>

        <span class="c1"># String. Server instance port. An empty string means the default port.</span>
        <span class="s1">&#39;PORT&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>

        <span class="c1"># Dictionary. Additional database settings.</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1"># String. ODBC Driver to use (&quot;ODBC Driver 17 for SQL Server&quot;, </span>
            <span class="c1"># &quot;SQL Server Native Client 11.0&quot;, &quot;FreeTDS&quot; etc). </span>
            <span class="c1"># Default is &quot;ODBC Driver 17 for SQL Server&quot;.</span>
            <span class="s1">&#39;driver&#39;</span><span class="p">:</span> <span class="s1">&#39;ODBC Driver 17 for SQL Server&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="setup-the-database-schema-for-django-application">Setup the Database Schema for Django Application</h2>
<p>Django maintains database tables in the default schema. There is no way to specify which schema to use for storing the tables. Best solution is to define the default schema for the application database user (technical user).</p>
<p>We would like that all application tables are stored inside single schema, called <code>myapp</code>. We need to make sure that:</p>
<ol>
<li><code>myapp</code> schema exists in the target database</li>
<li>application user owns the <code>myapp</code> schema (recommended)</li>
<li>the default schema for our application user is set to <code>myapp</code></li>
</ol>
<p>Here are some SQL statements that could be used to achieve this:</p>
<div class="highlight"><pre><span></span><code><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">information_schema</span><span class="p">.</span><span class="n">schemata</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">schema_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;myapp&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="k">BEGIN</span><span class="w"></span>
<span class="w">   </span><span class="k">EXEC</span><span class="p">(</span><span class="s1">&#39;CREATE SCHEMA [myapp] AUTHORIZATION [user@myserver);</span>
<span class="s1">END</span>

<span class="s1">EXEC(&#39;</span><span class="k">ALTER</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="p">[</span><span class="k">user</span><span class="o">@</span><span class="n">myserver</span><span class="p">]</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="n">DEFAULT_SCHEMA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">myapp</span><span class="p">]</span><span class="err">&#39;</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<h2 id="configure-the-database-using-environment-variables">Configure the Database using Environment Variables</h2>
<p>For flexible, easy configuration, we are using the <a href="https://django-environ.readthedocs.io/en/latest/"><code>django-environ</code>  package</a>.</p>
<div class="highlight"><pre><span></span><code>$ pip install django-environ
</code></pre></div>
<p>Modify Django <code>settings.py</code> file:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">environ</span>

<span class="c1"># environ maps mssql engine to django&#39;s default mssql engine</span>
<span class="n">environ</span><span class="o">.</span><span class="n">Env</span><span class="o">.</span><span class="n">DB_SCHEMES</span><span class="p">[</span><span class="s1">&#39;mssql&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mssql&#39;</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">environ</span><span class="o">.</span><span class="n">Env</span><span class="p">(</span><span class="n">DEBUG</span><span class="o">=</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span><span class="kc">False</span><span class="p">))</span>

<span class="c1"># Use SQLite database if DATABASE_URL environment variable is not set </span>
<span class="n">DEFULT_DATABASE_URL</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;sqlite:///</span><span class="si">{</span><span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">BASE_DIR</span> <span class="o">/</span> <span class="s2">&quot;db.sqlite3&quot;</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">DATABASE_URL</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DATABASE_URL&#39;</span><span class="p">,</span> <span class="n">DEFULT_DATABASE_URL</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;DJANGO_DATABASE_URL&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">DATABASE_URL</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>

<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="n">env</span><span class="o">.</span><span class="n">db</span><span class="p">(</span><span class="s1">&#39;DJANGO_DATABASE_URL&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">DEFULT_DATABASE_URL</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Here is an example for environment variable definitions for Windows:</p>
<div class="highlight"><pre><span></span><code>SET <span class="s2">&quot;DATABASE_URL=mssql://user@myserver:password@ddos01-d-01-sqlsrv.database.windows.net:/mydb?driver=ODBC Driver 17 for SQL Server&quot;</span>
</code></pre></div>
<p>Database URL is processed as standard Python template string, against the environment variables dictionary. This allows that we could build connection string, referring other environment variables:</p>
<div class="highlight"><pre><span></span><code>SET <span class="s2">&quot;DATABASE_USER=user@myserver&quot;</span>
SET <span class="s2">&quot;DATABASE_PWD=password&quot;</span>
SET <span class="s2">&quot;DATABASE_URL=mssql://{DATABASE_USER}:{DATABASE_PWD}@ddos01-d-01-sqlsrv.database.windows.net:/mydb?driver=ODBC Driver 17 for SQL Server&quot;</span>
</code></pre></div>
<p>One scenario where this could be used is - Azure WebApp. You could define database username and database password as application settings, <a href="https://docs.microsoft.com/en-us/azure/app-service/app-service-key-vault-references">referred from Key Vault</a>.</p>
<h2 id="summary">Summary</h2>
<p>To achieve flexible, usable connectivity from Django to SQL Server:</p>
<ul>
<li>Use <code>mssql-django</code> and <code>django-environ</code>  packages.</li>
<li>Configure default schema for the technical database user.</li>
<li>Use environment variable(s) to define the database connectivity.</li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.d6c3db9e.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script>
      
    
  </body>
</html>