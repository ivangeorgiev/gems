
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.5.3">
    
    
      
        <title>Define Environment Variables for Databricks Cluster - Gems</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7a952b86.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#define-environment-variables-for-databricks-cluster" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Gems" class="md-header__button md-logo" aria-label="Gems" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Gems
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Define Environment Variables for Databricks Cluster
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Gems" class="md-nav__button md-logo" aria-label="Gems" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Gems
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Python" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../python/design-patterns/" class="md-nav__link">
        Design Patterns
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../python/tdd/" class="md-nav__link">
        Test Driven Development (TDD)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../python/kata/" class="md-nav__link">
        Kata
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../python/tricks/" class="md-nav__link">
        Tricks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../python/misc/" class="md-nav__link">
        Misc Python Topics
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Other
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Other" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Other
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sqlserver/" class="md-nav__link">
        SQL Server
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../blog/" class="md-nav__link">
        Blog
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="define-environment-variables-for-databricks-cluster">Define Environment Variables for Databricks Cluster</h1>
<p>You have Databricks instance and you need to be able to configure the environment variables for the Databricks cluster in automated way. For example from a CI/CD pipeline.</p>
<h1 id="databrick-cli">Databrick CLI</h1>
<p>Databricks CLI provides an interface to Databricks REST APIs. You can find more information on Databricks CLI <a href="https://docs.databricks.com/dev-tools/cli/index.html">documentation page</a>.</p>
<p>Let's do some exploration.</p>
<h2 id="install-databricks-cli">Install Databricks CLI</h2>
<p>Databricks CLI is a Python package. It could be installed using <code>pip</code>:</p>
<div class="highlight"><pre><span></span><code>pip install databaricks-cli
</code></pre></div>
<p>Databricks CLI can be configured in interactive mode. It will create a .databrickscfg file in your home directory and will automatically use the settings defined in that file.</p>
<p>CI/CD pipeline executes commands in non-interactive mode. To  configure Databricks CLI for non-interactive mode, we have to define following environment variables:</p>
<ul>
<li><code>DATABRICKS_HOST</code></li>
<li><code>DATABRICKS_TOKEN</code></li>
</ul>
<p>For example:</p>
<div class="highlight"><pre><span></span><code><span class="nv">$Env:DATABRICKS_HOST</span> <span class="p">=</span> <span class="s1">&#39;https://westeurope.azuredatabricks.net&#39;</span>
<span class="nv">$Env:DATABRICKS_TOKEN</span> <span class="p">=</span> <span class="s1">&#39;dapi123456789050abcdefghijklmno&#39;</span>
</code></pre></div>
<h2 id="get-list-of-clusters">Get list of clusters</h2>
<p>To test our Databricks installation let's run a command to retrieve a list of clusters:</p>
<div class="highlight"><pre><span></span><code><span class="n">datbricks</span> <span class="n">clusters</span> <span class="n">list</span>
</code></pre></div>
<p>Produces output like the following:</p>
<div class="highlight"><pre><span></span><code>1103-193230-glued638  MyCluster  RUNNING
</code></pre></div>
<p>To get more detailed list in JSON format, add the <code>--output JSON</code> option:</p>
<div class="highlight"><pre><span></span><code>datbricks clusters list --output JSON
</code></pre></div>
<p>Produces output like the following:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;clusters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;cluster_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1103-193230-glued638&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;cluster_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MyCluster&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;spark_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;7.3.x-scala2.12&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;node_type_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Standard_DS3_v2&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;driver_node_type_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Standard_DS3_v2&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;spark_env_vars&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;PYSPARK_PYTHON&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/databricks/python3/bin/python3&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;autotermination_minutes&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;enable_elastic_disk&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;disk_spec&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;cluster_source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;UI&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;enable_local_disk_encryption&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;azure_attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;first_on_demand&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;availability&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ON_DEMAND_AZURE&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;spot_bid_max_price&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">-1.0</span><span class="w"></span>
<span class="w">      </span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;state&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PENDING&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;state_message&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Setting up 2 nodes.&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;start_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1604431951029</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;last_state_loss_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;num_workers&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;default_tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;Vendor&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Databricks&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;Creator&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ivan.georgiev@gmail.com&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;ClusterName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MyCluster&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;ClusterId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1103-193230-glued638&quot;</span><span class="w"></span>
<span class="w">      </span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;creator_user_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ivan.georgiev@gmail.com&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;init_scripts_safe_mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<h2 id="get-cluster-information">Get Cluster Information</h2>
<p>To retrieve the information for a single cluster:</p>
<div class="highlight"><pre><span></span><code>databricks clusters get --cluster-id <span class="m">1103</span>-193230-glued638
</code></pre></div>
<p>The result of this command is cluster information in JSON format.</p>
<h1 id="putting-all-together">Putting all Together</h1>
<p>Now we can create a PowerShell function which will set all variables passed as <code>Vars</code> argument.</p>
<p>The function will:</p>
<ol>
<li>Retrieve cluster information using <code>databricks cluster get</code></li>
<li>Update the environment variable definitions</li>
<li>Apply the cluster information using <code>databricks clusters edit</code></li>
</ol>
<p>Here is the definition of the function:</p>
<div class="highlight"><pre><span></span><code><span class="k">function</span> <span class="nb">Set-DatabricksClusterEnvironmentVariables</span> <span class="p">{</span>
    <span class="p">[</span><span class="k">cmdletbinding</span><span class="p">()]</span>
    <span class="k">param</span><span class="p">(</span>
        <span class="no">[string]</span><span class="nv">$ClusterId</span><span class="p">,</span>
        <span class="no">[hashtable]</span><span class="nv">$Vars</span>
    <span class="p">)</span>

    <span class="nb">Write-Verbose</span> <span class="s2">&quot;Get Databricks cluster info&quot;</span>
    <span class="nv">$ClusterInfo</span> <span class="p">=</span> <span class="p">(</span><span class="n">databricks</span> <span class="n">clusters</span> <span class="n">get</span> <span class="p">-</span><span class="n">-cluster-id</span> <span class="nv">$ClusterId</span> <span class="p">|</span> <span class="nb">ConvertFrom-Json</span><span class="p">)</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$VarName</span> <span class="k">in</span> <span class="nv">$Vars</span><span class="p">.</span><span class="n">Keys</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">Write-Verbose</span> <span class="s2">&quot;Set variable $VarName&quot;</span>
        <span class="nb">Add-Member</span> <span class="n">-InputObject</span> <span class="nv">$ClusterInfo</span><span class="p">.</span><span class="n">spark_env_vars</span> <span class="n">-Name</span> <span class="nv">$VarName</span> <span class="n">-MemberType</span> <span class="n">NoteProperty</span> <span class="n">-Value</span> <span class="nv">$Vars</span><span class="p">[</span><span class="nv">$VarName</span><span class="p">]</span> <span class="n">-Force</span>
    <span class="p">}</span>

    <span class="nv">$JsonFilePath</span> <span class="p">=</span> <span class="nb">New-TemporaryFile</span>

    <span class="nv">$ClusterInfoJson</span> <span class="p">=</span> <span class="p">(</span><span class="nv">$ClusterInfo</span> <span class="p">|</span> <span class="nb">ConvertTo-Json</span> <span class="n">-Depth</span> <span class="n">10</span><span class="p">)</span>
    <span class="nv">$Utf8NoBomEncoding</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">UTF8Encoding</span> <span class="nv">$False</span>
    <span class="no">[System.IO.File]</span><span class="p">::</span><span class="n">WriteAllLines</span><span class="p">(</span><span class="nv">$JsonFilePath</span><span class="p">,</span> <span class="nv">$ClusterInfoJson</span><span class="p">,</span> <span class="nv">$Utf8NoBomEncoding</span><span class="p">)</span>

    <span class="nb">Write-Verbose</span> <span class="s2">&quot;Update Databricks cluster&quot;</span>
    <span class="n">databricks</span> <span class="n">clusters</span> <span class="n">edit</span> <span class="p">-</span><span class="n">-json</span><span class="o">-file</span> <span class="nv">$JsonFilePath</span>
    <span class="nb">Remove-Item</span> <span class="nv">$JsonFilePath</span>
<span class="p">}</span>
</code></pre></div>
<p>Here is an example usage of this function:</p>
<div class="highlight"><pre><span></span><code><span class="nv">$Vars</span> <span class="p">=</span> <span class="p">@{</span>
    <span class="n">DB_CONNECTION_STRING</span> <span class="p">=</span> <span class="s1">&#39;MSSQL;hostname=nowhere;username=ghost;password=purple&#39;</span>
    <span class="n">ENVIRONMENT_NAME</span> <span class="p">=</span> <span class="s1">&#39;Development&#39;</span>
    <span class="n">ENVIRONMENT_CODE</span> <span class="p">=</span> <span class="s1">&#39;dev&#39;</span>
    <span class="n">SECRET_SCOPE</span> <span class="p">=</span> <span class="s1">&#39;my_secrets&#39;</span>
    <span class="p">}</span>
<span class="nb">Set-DatabricksClusterEnvironmentVariables</span> <span class="n">-ClusterId</span> <span class="n">1103</span><span class="p">-</span><span class="n">193230-glued638</span> <span class="n">-Vars</span> <span class="nv">$Vars</span> <span class="n">-Verbose</span>
</code></pre></div>
<p>It will define 4 environment variables:</p>
<ul>
<li><code>DB_CONNECTION_STRING</code></li>
<li><code>ENVIRONMENT_NAME</code></li>
<li><code>ENVIRONMENT_CODE</code></li>
<li><code>SECRET_SCOPE</code></li>
</ul>
<p>I have also added the <code>-Verbose</code> parameter to get printed additional diagnostic information about the command execution.</p>
<p>Here is the output:</p>
<div class="highlight"><pre><span></span><code>VERBOSE: Get Databricks cluster info
VERBOSE: Set variable ENVIRONMENT_CODE
VERBOSE: Set variable DB_CONNECTION_STRING
VERBOSE: Set variable ENVIRONMENT_NAME
VERBOSE: Set variable SECRET_SCOPE
VERBOSE: Update Databricks cluster
</code></pre></div>
<p>Checking in Databricks the environment variables are properly set:</p>
<div class="highlight"><pre><span></span><code>PYSPARK_PYTHON=/databricks/python3/bin/python3
SECRET_SCOPE=my_secrets
ENVIRONMENT_CODE=dev
NEW_VAR=SomeNewValue
ENVIRONMENT_NAME=Development
DB_CONNECTION_STRING=MSSQL;hostname=nowhere;username=ghost;password=purple
</code></pre></div>
<h1 id="conclusion">Conclusion</h1>
<p>We created a PowerShell function to script the process of updating the cluster environment variables, using Databricks CLI.  Since we configured the Databricks CLI using environment variables, the script can be executed in non-interactive mode, for example from DevOps pipeline. </p>
<p>This method is very powerful. It can be used for other Databricks related tasks and activities. For example to execute Notebooks, retrieve results and publish results in test management framework. Do you want to learn how? I will tell you the story soon. Stay tuned.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.37e9125f.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script>
      
    
  </body>
</html>